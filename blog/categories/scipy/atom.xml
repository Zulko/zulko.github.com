<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Scipy, | __del__( self )]]></title>
  <link href="http://Zulko.github.io/blog/categories/scipy/atom.xml" rel="self"/>
  <link href="http://Zulko.github.io/"/>
  <updated>2014-06-09T14:19:10+02:00</updated>
  <id>http://Zulko.github.io/</id>
  <author>
    <name><![CDATA[Zulko]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Delay differential equations in Python]]></title>
    <link href="http://Zulko.github.io/blog/2013/10/22/delay-differential-equations-in-python/"/>
    <updated>2013-10-22T07:50:00+02:00</updated>
    <id>http://Zulko.github.io/blog/2013/10/22/delay-differential-equations-in-python</id>
    <content type="html"><![CDATA[<p><em>I wrote</em> <a href="https://github.com/Zulko/ddeint">ddeint</a>, <em>a simple module/function for solving Delay Differential Equations (DDEs) in Python. It is not very fast, but very flexible, and coded in just <a href="https://gist.github.com/Zulko/7096011">a few lines</a> on top of Scipy’s differential equations solver,</em> <code>odeint</code>.</p>

<!-- more -->

<p>Say you have a delay differential equation like this:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[

\begin{cases}
y(t) = g(t), \,\,\,\, &\mbox{for $t<0$} \\
y'(t) = F( y, t), \,\,\,\, &\mbox{for $t \geq 0$},
\end{cases}
 %]]&gt;</script>

<p>where $F(y, t)$ can involve delayed values of $y$, of the form $y(t-d)$.</p>

<p>To solve this DDE system at points <code>t=[t1, t2 ...]</code> you would just write</p>

<p>{% codeblock lang:python %}
y = ddeint(F, g, t) # returns [y(t1), y(t2) …]
{% endcodeblock %}</p>

<h2 id="a-simple-example">A simple example</h2>

<p>Let us start with a DDE whose exact solution is known (it is the sine function), just to check that the algorithm works as expected:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[

\begin{cases}
y(t) = \sin(t), \,\,\,\, &\mbox{for $t<0$} \\ 
y'(t) = y(t-3\pi/2), \,\,\,\, &\mbox{for $t \geq 0$}
\end{cases}
 %]]&gt;</script>

<p>Here is how we solve it with <code>ddeint</code>:</p>

<p>{% codeblock lang:python %}
from pylab import *
from ddeint import ddeint</p>

<p>model = lambda Y,t : Y(t - 3*pi/2) # Model
tt = linspace(0,50,10000) # Time start, time end, nb of points/steps
g=sin # Expression of Y(t) before the integration interval
yy = ddeint(model,g,tt) # Solving</p>

<h1 id="plotting">PLOTTING</h1>
<p>plot(tt,yy,c=’r’,label=”$y(t)$”)
plot(tt,sin(tt),c=’b’,label=”$sin(t)$”)
set_ylim(ymax=2) # make room for the legend
legend()
{% endcodeblock %}</p>

<p>{% img center /images/ddeint/dde_sin.jpeg %}</p>

<p>The resulting plot compares our solution (red) with the exact solution (blue). See how our result eventually detaches itself from the actual solution as a consequence of many successive approximations ? As DDEs tend to create chaotic behaviors, you can expect the error to explode very fast. As I am no DDE expert, I would recommend checking for convergence in all cases, i.e. increasing the time resolution and see how it affects the result. Keep in mind that the past values of Y(t) are computed by interpolating the values of Y found at the previous integration points, so the more points you ask for, the more precise your result.</p>

<h2 id="an-example-with-parameters">An example with parameters</h2>

<p>You can set the parameters of your model at integration time, like in Scipy’s <code>ODE</code> and <code>odeint</code>. As an example, imagine a chemical product with degradation rate $r$, and whose production rate is negatively linked to the quantity of this same product at the time $(t-d)$:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[

\begin{cases}
y(t) = 0, \,\,\,\, &\mbox{for $t<0$} \\
y'(t) = \dfrac{1}{1+(\dfrac{y(t-d)}{K})^2} -ry(t), \,\,\,\,
&\mbox{ for $t\geq 0$}.
\end{cases}
 %]]&gt;</script>

<p>We have three parameters that we can choose freely. For $K = 0.1$, $d = 5$, $r = 1$, we obtain oscillations !</p>

<p>{% codeblock lang:python %}
# MODEL, WITH UNKNOWN PARAMETERS
model = lambda Y,t, k,d,r :  1/(1+(Y(t-d)/k)<em>*2) - r</em>Y(t)
g = lambda t:0 # history before t=0</p>

<p>tt = linspace(0,50,10000)
yy = ddeint(model, g, tt, fargs=(0.1, 5, 1)) # K=0.1, d=5, r=1</p>

<p>plot(tt,yy,lw=2)
{% endcodeblock %}</p>

<p>{% img center /images/ddeint/dde_negativefeedback.jpeg %}</p>

<h2 id="example-with-several-variables">Example with several variables</h2>

<p>The variable Y can be a vector, which means that you can solve DDE 
systems of several variables. Here is a version of the famous 
Lotka-Volterra two-variables system, where we introduce a delay $d$. 
For $d=0$ the system is a classical Lotka-Volterra system ; for 
$d\neq 0$ the system undergoes an important amplification:</p>

<script type="math/tex; mode=display">% &lt;![CDATA[

\begin{cases}
\big(x(t), y(t)\big) = (1,2) \,\,\,\, &\mbox{for $t<0$}, \\
x'(t) = 0.5x(t)\big(1-y(t-d)\big) \,\,\,\, &\mbox{for $t\geq 0$}, \\
y'(t) = -0.5y(t)\big(1-x(t-d)\big) \,\,\,\, &\mbox{for $\geq 0$}.
\end{cases}
 %]]&gt;</script>

<p>{% codeblock lang:python %}
def model(Y,t,d):
    x,y = Y(t)
    xd,yd = Y(t-d)
    return array([0.5<em>x</em>(1-yd), -0.5<em>y</em>(1-xd)])</p>

<p>g = lambda t : array([1,2])
tt = linspace(2,30,20000)</p>

<p>for d in [0, 0.2]:
    yy = ddeint(model,g,tt,fargs=(d,))
    # WE PLOT X AGAINST Y
    plot(yy[:,0], yy[:,1], lw=2, label=’delay = %.01f’%d)</p>

<p>legend() # display the legend
{% endcodeblock %}</p>

<p>{% img center /images/ddeint/dde_lotka.jpeg %}</p>

<h2 id="example-with-a-non-constant-delay">Example with a non-constant delay</h2>

<p>In this last example the delay depends on the value of $y(t)$ :</p>

<script type="math/tex; mode=display">% &lt;![CDATA[

\begin{cases}
y(t) = 1, \,\,\,\, &\mbox{for $t<0$}, \\
y'(t) = - y\big(t-3\cos(y(t))^2 \big),\,\,\,\,
&\mbox{for $t \geq 0$}.
\end{cases}
 %]]&gt;</script>

<p>{% codeblock lang:python %}
model = lambda Y,t:  -Y( t-3*cos( Y(t) )**2 )
tt = linspace(0, 30, 2000)
yy = ddeint(model, lambda t:1, tt)</p>

<p>plot(tt, yy)
{% endcodeblock %}</p>

<p>{% img center /images/ddeint/ydependent.jpeg %}</p>
]]></content>
  </entry>
  
</feed>
