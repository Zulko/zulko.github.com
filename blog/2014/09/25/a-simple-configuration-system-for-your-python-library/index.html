
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>A simple configuration system for your Python library - __del__( self )</title>
  <meta name="author" content="Zulko">

  
  <meta name="description" content="This post shows how easy it is to handle global configuration variables for a Python library. Suppose that you wrote a graph plotting library (let’s &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Zulko.github.io/blog/2014/09/25/a-simple-configuration-system-for-your-python-library">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="__del__( self )" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner">
            <!-- mathjax config similar to math.stackexchange -->
            <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
              jax: ["input/TeX", "output/HTML-CSS"],
              tex2jax: {
                inlineMath: [ ['$', '$'] ],
                displayMath: [ ['$$', '$$']],
                processEscapes: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
              },
              messageStyle: "none",
              "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
            });
            </script>
            <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
      <hgroup>
  <h1><a href="/">__del__( self )</a></h1>
  
    <h2>Eaten by the Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Zulko.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">A Simple Configuration System for Your Python Library</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-09-25T00:48:00+02:00" pubdate data-updated="true">Sep 25<span>th</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>This post shows how easy it is to handle global configuration variables for a Python library.</em></p>

<p>Suppose that you wrote a graph plotting library (let’s call it <code>myplotlib</code>) with dozens of functions to plot all sorts of graph. You want all these functions to share some default values and settings (like the plot’s default size, the default font used for the texts, or which program to use to save to convert the plot to JPEG). And you want these global settings to be easily modifiable, at least for the duration of a session, by the people using your library.</p>

<p>This seems to be a very general problem and I had expected to find a <em>standard</em> or <em>preferred</em> to implement that in Python, but I couldn’t find anything.  In this post I propose a simple system (feel free to criticize). I first explain how it it used (so that you can see if it fits your needs) and then how you implement it.</p>

<h2 id="how-you-use-it">How you use it</h2>

<p><strong>Default settings</strong></p>

<p>Your library contains a file <code>conf_defaults.py</code> in which you, the author, define the library’s default configuration:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">&quot;&quot;&quot; File conf_defaults.py: stores myplotlib&#39;s global settings. &quot;&quot;&quot;</span>
</span><span class="line"><span class="n">DEFAULT_FONT</span> <span class="o">=</span> <span class="s">&quot;Georgia&quot;</span>
</span><span class="line"><span class="n">DEFAULT_FONTSIZE</span> <span class="o">=</span> <span class="mi">14</span>
</span><span class="line"><span class="n">DEFAULT_FIGURE_HEIGHT</span> <span class="o">=</span> <span class="mi">800</span> <span class="c"># in pixels</span>
</span><span class="line"><span class="n">USE_ANTIALIASING</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class="line"><span class="c"># etc...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><strong>Custom settings</strong></p>

<p>In any python script using the library it will be possible to override the default configuration, with immediate effect throughout the library, as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">myplotlib.conf</span>
</span><span class="line"><span class="n">myplotlib</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">change_settings</span><span class="p">({</span><span class="s">&#39;DEFAULT_FONTSIZE&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span><span class="line">                                <span class="s">&#39;USE_ANTIALIASING&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Alternatively it will also be possible provide a custom configuration file:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">myplotlib.conf</span>
</span><span class="line"><span class="n">myplotlib</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">change_settings</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s">&#39;path/to/my_custom_conf.py&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The <code>my_custom_conf.py</code> in this example must be organized as <code>conf_defaults.py</code> above and overwrites some or all of the configuration variables.</p>

<p><strong>Accessing the settings</strong></p>

<p>In any file of your library you will have access the configuration parameters through <code>myplotlib.conf.get_setting</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">myplotlib.conf</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="s">&#39;default&#39;</span><span class="p">):</span>
</span><span class="line">
</span><span class="line">    <span class="k">if</span> <span class="n">fontsize</span> <span class="o">==</span> <span class="s">&#39;default&#39;</span><span class="p">:</span>
</span><span class="line">        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">myplotlib</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get_setting</span><span class="p">(</span><span class="s">&#39;DEFAULT_FONTSIZE&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="c"># now draw the text...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>A more elegant use of <code>get_setting</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">myplotlib.conf</span>
</span><span class="line"><span class="n">conf</span> <span class="o">=</span> <span class="n">myplotlib</span><span class="o">.</span><span class="n">conf</span><span class="o">.</span><span class="n">get_settings</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">parameters</span><span class="p">):</span>
</span><span class="line">    <span class="c"># We use dictionnary.get(key, default=...)</span>
</span><span class="line">    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;fontsize&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="p">(</span><span class="s">&quot;DEFAULT_FONTSIZE&quot;</span><span class="p">)</span>
</span><span class="line">    <span class="n">height</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="p">(</span><span class="s">&quot;DEFAULT_FIGURE_HEIGHT&quot;</span><span class="p">))</span>
</span><span class="line">    <span class="n">width</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;width&#39;</span><span class="p">,</span> <span class="n">conf</span><span class="p">(</span><span class="s">&quot;DEFAULT_FIGURE_WIDTH&quot;</span><span class="p">))</span>
</span><span class="line">    <span class="c"># now draw the text...</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Note that <code>get_setting</code> must always be called from inside a function, otherwise <code>change_settings</code> won’t have any effect. </p>

<p>In case the user attempts to get or set a configuration variable that is not in the setting, a proper error message is returned.</p>

<h2 id="how-you-implement-it">How you implement it</h2>

<p>In the main folder of your librairy (the one with the file <code>__init__.py</code>), add a file <code>conf_defaults.py</code> (as presented above) and another file called <code>conf.py</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">my_package/
</span><span class="line">  __init__.py
</span><span class="line">  conf.py             &lt;=
</span><span class="line">  conf_defaults.py    &lt;=
</span><span class="line">  README.rst
</span><span class="line">  some_file.py
</span><span class="line">  some_other_file.py
</span><span class="line">  #etc.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>In <code>conf.py</code> write the following:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="sd">&quot;&quot;&quot; Module to handle default and custom configuration variables &quot;&quot;&quot;</span>
</span><span class="line">
</span><span class="line"><span class="kn">from</span> <span class="nn">conf_defaults</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">get_setting</span><span class="p">(</span><span class="n">varname</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Returns the value of a configuration variable. &quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">gl</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
</span><span class="line">    <span class="k">if</span> <span class="n">varname</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gl</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span class="line">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;Unknown setting </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">varname</span><span class="p">)</span>
</span><span class="line">    <span class="c"># Here, possibly add some code to raise exceptions if some</span>
</span><span class="line">    <span class="c"># parameter isn&#39;t set set properly, explaining on how to set it.</span>
</span><span class="line">    <span class="k">return</span> <span class="n">gl</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">change_settings</span><span class="p">(</span><span class="n">new_settings</span><span class="o">=</span><span class="p">{},</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Changes the value of configuration variables.&quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">gl</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span>
</span><span class="line">    <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="line">        <span class="nb">execfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
</span><span class="line">        <span class="n">gl</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">locals</span><span class="p">())</span>
</span><span class="line">    <span class="n">gl</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_settings</span><span class="p">)</span>
</span><span class="line">    <span class="c"># Here you can add some code  to check that the new configuration</span>
</span><span class="line">    <span class="c"># values are valid.</span>
</span><span class="line">
</span><span class="line"><span class="c"># Here you can add some code, for instance to automatically set</span>
</span><span class="line"><span class="c"># the configuration values for some variables.</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="thats-all-folks">That’s all folks</h2>

<p>If you want to test it I made this <a href="">demonstration package</a></p>

<p>I hope this helped. I wrote this post because I couldn’t find any clear explanation of how configurations should work in Python, until @bobastar on Github hinted the <code>conf.py</code> trick.</p>

<p>Any feedback would be appreciated, I think we definitely need do discuss a standard way to do configuration management in Python.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Zulko</span></span>

      








  


<time datetime="2014-09-25T00:48:00+02:00" pubdate data-updated="true">Sep 25<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://Zulko.github.io/blog/2014/09/25/a-simple-configuration-system-for-your-python-library/" data-via="" data-counturl="http://Zulko.github.io/blog/2014/09/25/a-simple-configuration-system-for-your-python-library/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/09/24/finding-video-loops-with-python/" title="Previous Post: Finding video loops with Python">&laquo; Finding video loops with Python</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/10/14/writing-an-autocompletion-friendly-python-library/" title="Next Post: How to write an autocompletion-friendly Python library">How to write an autocompletion-friendly Python library &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/11/13/things-you-can-do-with-python-and-pov-ray/">Things You Can Do With Python and POV-Ray</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/10/14/writing-an-autocompletion-friendly-python-library/">How to Write an Autocompletion-friendly Python Library</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/25/a-simple-configuration-system-for-your-python-library/">A Simple Configuration System for Your Python Library</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/finding-video-loops-with-python/">Finding Video Loops With Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/20/vector-animations-with-python/">Vector Animations With Python</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Zulko">@Zulko</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Zulko',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Zulko -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'zulkoghio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Zulko.github.io/blog/2014/09/25/a-simple-configuration-system-for-your-python-library/';
        var disqus_url = 'http://Zulko.github.io/blog/2014/09/25/a-simple-configuration-system-for-your-python-library/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
