
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Some more Videogreping with Python - __del__( self )</title>
  <meta name="author" content="Zulko">

  
  <meta name="description" content="In this post I give a minimalistic version of Sam Lavigne’s Videogrep and use it to promote world peace. This week Sam Lavigne wrote a very &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://Zulko.github.io/blog/2014/06/21/some-more-videogreping-with-python">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="__del__( self )" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner">
            <!-- mathjax config similar to math.stackexchange -->
            <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
              jax: ["input/TeX", "output/HTML-CSS"],
              tex2jax: {
                inlineMath: [ ['$', '$'] ],
                displayMath: [ ['$$', '$$']],
                processEscapes: true,
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
              },
              messageStyle: "none",
              "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
            });
            </script>
            <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
      <hgroup>
  <h1><a href="/">__del__( self )</a></h1>
  
    <h2>Eaten by the Python.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Zulko.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Some More Videogreping With Python</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-21T18:03:00+02:00" pubdate data-updated="true">Jun 21<span>st</span>, 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><em>In this post I give a minimalistic version of Sam Lavigne’s Videogrep and use it to promote world peace.</em></p>

<!-- more -->

<p>This week Sam Lavigne wrote a very entertaining <a href="http://lav.io/2014/06/videogrep-automatic-supercuts-with-python/">blog post</a> introducing Videogrep, a Python script that searches through dialog in videos (using the associated subtitles file), selects scenes (for instance all scenes containing a given word), and cuts together a new video.</p>

<p>The <a href="https://github.com/antiboredom/videogrep">script on Github</a> implements many tweaks and goodies (such as working on multiple files, identifying complex patterns, etc.). In this post I present the code for a minimal videogreper in Python and attempt to refine cuts to get scenes containing whole sentences or single words.</p>

<h2 id="getting-started">Getting started</h2>

<p>A good place to find public domain videos with subtitles is the White House channel on Youtube. In what follows I will be working on the 2012 State Of The Union Address:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/Zgfi7wnGZlE "></iframe></div>

<p>To get both the video and the subtitles you can use <a href="http://rg3.github.io/youtube-dl/">youtube-dl</a> in a terminal:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class=""><span class="line">youtube-dl --write-srt --srt-lang en Zgfi7wnGZlE state.mp4</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This downloads a video file <code>state.mp4</code> and a text file <code>state.en.srt</code> indicating the subtitles as follows:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class=""><span class="line">1
</span><span class="line">00:00:00,166 --&gt; 00:00:00,667
</span><span class="line">(applause)
</span><span class="line">
</span><span class="line">2
</span><span class="line">00:00:00,667 --&gt; 00:00:02,066
</span><span class="line">The President:
</span><span class="line">Thank you.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This file can be easily parsed in Python to get a list of elements of the form <code>([t_start,t_end], text_block)</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">import</span> <span class="nn">re</span> <span class="c"># module for regular expressions</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">convert_time</span><span class="p">(</span><span class="n">timestring</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Converts a string into seconds &quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">nums</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&#39;\d+&#39;</span><span class="p">,</span> <span class="n">timestring</span><span class="p">))</span>
</span><span class="line">    <span class="k">return</span> <span class="mi">3600</span><span class="o">*</span><span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">60</span><span class="o">*</span><span class="n">nums</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nums</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">nums</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span>
</span><span class="line">
</span><span class="line"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;state.en.srt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class="line">    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span class="line">
</span><span class="line"><span class="n">times_texts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class="line"><span class="n">current_times</span> <span class="p">,</span> <span class="n">current_text</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
</span><span class="line"><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span class="line">    <span class="n">times</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;[0-9]*:[0-9]*:[0-9]*,[0-9]*&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">times</span> <span class="o">!=</span> <span class="p">[]:</span>
</span><span class="line">        <span class="n">current_times</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">convert_time</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">line</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
</span><span class="line">        <span class="n">times_texts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">current_times</span><span class="p">,</span> <span class="n">current_text</span><span class="p">))</span>
</span><span class="line">        <span class="n">current_times</span><span class="p">,</span> <span class="n">current_text</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
</span><span class="line">    <span class="k">elif</span> <span class="n">current_times</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
</span><span class="line">        <span class="n">current_text</span> <span class="o">=</span> <span class="n">current_text</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot; &quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">print</span> <span class="p">(</span><span class="n">times_texts</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt;&gt;&gt; [([0.166, 0.667], '(applause) '),
</span><span class="line">&gt;&gt;&gt;  ([0.667, 2.066], 'The President: Thank you. ')
</span><span class="line">&gt;&gt;&gt;   ... ]</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="a-simple-videogreper">A simple videogreper</h2>

<p>Let us have a look at the most common words in the speech:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
</span><span class="line"><span class="n">whole_text</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">text</span> <span class="k">for</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">times_texts</span><span class="p">])</span>
</span><span class="line"><span class="n">all_words</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;\w+&quot;</span><span class="p">,</span> <span class="n">whole_text</span><span class="p">)</span>
</span><span class="line"><span class="n">counter</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">all_words</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">])</span>
</span><span class="line"><span class="k">print</span> <span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class=""><span class="line">&gt;&gt;&gt; [('applause', 82), ('american', 35), ('america', 33), ('because', 25),
</span><span class="line">&gt;&gt;&gt;  ('should', 24), ('energy', 23), ('people', 23), ('americans', 20),
</span><span class="line">&gt;&gt;&gt;  ('country', 18), ('cheering', 15)]</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Seems like the word <em>“should”</em> has been pronounced a lot. Let us find the times of all the subtitle blocks in which it appears:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="n">times</span> <span class="k">for</span> <span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">times_texts</span>
</span><span class="line">        <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;should&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[])]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Now we cut and put together all these scenes using MoviePy:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">moviepy.editor</span> <span class="kn">import</span> <span class="n">VideoFileClip</span><span class="p">,</span> <span class="n">concatenate</span>
</span><span class="line">
</span><span class="line"><span class="n">video</span> <span class="o">=</span> <span class="n">VideoFileClip</span><span class="p">(</span><span class="s">&quot;state.mp4&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">assemble_cuts</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Concatenate cuts and generate a video file. &quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">final</span> <span class="o">=</span> <span class="n">concatenate</span><span class="p">([</span><span class="n">video</span><span class="o">.</span><span class="n">subclip</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span class="line">                         <span class="k">for</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cuts</span><span class="p">])</span>
</span><span class="line">    <span class="n">final</span><span class="o">.</span><span class="n">to_videofile</span><span class="p">(</span><span class="n">outputfile</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">assemble_cuts</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="s">&quot;should.mp4&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Here is the result:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/dNme5GR1Al4 "></iframe></div>

<p>It is promising, but in some scenes we don’t get to know exactly <em>what should be done</em>, which is frustrating. In the next section we add a little content-awareness to get more relevant cuts.</p>

<h2 id="greping-whole-sentences">Greping whole sentences</h2>

<p>We now want to cut together all the sentences containing the word <em>“should”</em>. We first explore the whole text looking for sentences containing that word, then we find the subtitle blocks corresponding to the start and end of each sentence, and we cut the video file accordingly.</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">times</span><span class="p">,</span> <span class="n">texts</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">times_texts</span><span class="p">)</span>
</span><span class="line"><span class="n">txt_lengths</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">len</span><span class="p">,</span> <span class="n">texts</span><span class="p">)</span> <span class="c"># length of each subtitle block</span>
</span><span class="line"><span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="nb">sum</span><span class="p">(</span><span class="n">txt_lengths</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">texts</span><span class="p">))]</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">find_times</span><span class="p">(</span><span class="n">position</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Finds the (t_start, t_end) in the subtitles</span>
</span><span class="line"><span class="sd">        for a given position in the whole text. &quot;&quot;&quot;</span>
</span><span class="line">    <span class="k">return</span> <span class="n">times</span><span class="p">[</span> <span class="nb">max</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span>
</span><span class="line">                       <span class="k">if</span> <span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">position</span><span class="p">)])]</span>
</span><span class="line">
</span><span class="line"><span class="c"># Regular expression matching all sentences with &#39;should&#39;</span>
</span><span class="line"><span class="n">regexpr</span> <span class="o">=</span> <span class="s">&quot;([A-Z][^\.!?]*</span><span class="si">%s</span><span class="s">[^\.!?]*[\.!?])&quot;</span><span class="o">%</span><span class="p">(</span><span class="s">&quot;should&quot;</span><span class="p">)</span>
</span><span class="line">
</span><span class="line"><span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">find_times</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">())[</span><span class="mi">0</span><span class="p">],</span> <span class="n">find_times</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">())[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="line">         <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">regexpr</span><span class="p">,</span> <span class="n">whole_text</span><span class="p">)</span> <span class="p">]</span>
</span><span class="line">
</span><span class="line"><span class="n">assemble_cuts</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="s">&quot;should_sentence.mp4&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>It’s much better:</p>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/0nDgurPQsXc "></iframe></div>

<p>Note that with just a little more code you could achieve much more. In Videogrep the author uses the Python package <code>pattern</code> to look for advanced phrase constructions, such as all phrases of the form gerund-determiner-adjective-noun.</p>

<h2 id="greping-single-words">Greping single words</h2>

<p>Let us take a step in the other direction and see if it is possible to automatically cut a scene with exactly one word or expression, and as little possible of the words around it. Consider the following subtitle block:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class=""><span class="line">00:03:20,100 --&gt; 00:03:23,100
</span><span class="line">We can do this.</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We can roughly evaluate that the word <em>“We”</em> will be pronounced in the first quarter of the time span (from 3:20.1 to 3:20.85), <em>“can”</em> in the second quarter (from 3:20.85 to 3:21.6), etc. Following this reasoning, here is a function that finds the <em>exact</em> times using the relative position of the characters in the subtitles blocks:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="k">def</span> <span class="nf">find_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">padding</span><span class="o">=.</span><span class="mo">05</span><span class="p">):</span>
</span><span class="line">    <span class="sd">&quot;&quot;&quot; Finds all &#39;exact&#39; (t_start, t_end) for a word &quot;&quot;&quot;</span>
</span><span class="line">    <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
</span><span class="line">               <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">times_texts</span><span class="p">]</span>
</span><span class="line">    <span class="k">return</span> <span class="p">[(</span><span class="n">t1</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span>
</span><span class="line">             <span class="n">t1</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="n">padding</span><span class="p">)</span>
</span><span class="line">             <span class="k">for</span> <span class="n">m</span><span class="p">,((</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">),</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">times_texts</span><span class="p">)</span>
</span><span class="line">             <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)]</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Let us try it on <em>“Americans”</em>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">assemble_cuts</span><span class="p">(</span> <span class="n">find_word</span><span class="p">(</span><span class="s">&quot;Americans&quot;</span><span class="p">),</span> <span class="s">&quot;americans.mp4&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/L59kcu6Zy9Q "></iframe></div>

<p>At least some of the cuts worked properly. If we use much-pronounced words we may find at least one correct cut for each of them and we can build a whole sentence:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;Americans&quot;</span><span class="p">,</span> <span class="s">&quot;must&quot;</span><span class="p">,</span> <span class="s">&quot;develop&quot;</span><span class="p">,</span> <span class="s">&quot;open &quot;</span><span class="p">,</span> <span class="s">&quot;source&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="s">&quot; software&quot;</span><span class="p">,</span> <span class="s">&quot;for the&quot;</span><span class="p">,</span> <span class="s">&quot; rest &quot;</span><span class="p">,</span> <span class="s">&quot;of the world&quot;</span><span class="p">,</span>
</span><span class="line">          <span class="s">&quot;instead of&quot;</span><span class="p">,</span> <span class="s">&quot; soldiers&quot;</span><span class="p">]</span>
</span><span class="line"><span class="n">numbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c"># take clip number &#39;n&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_word</span><span class="p">(</span><span class="n">word</span><span class="p">)[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)]</span>
</span><span class="line"><span class="n">assemble_cuts</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="s">&quot;fake_speech.mp4&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/iWRYGULFd_c "></iframe></div>

<p>Wow ! That seemed <em>so</em> real, and it almost made sense. From there the cuts could be refined by hand, but the script did most of the work and surely deserved, if not a Nobel Peace Prize, fourteen minutes of applause:</p>

<div class="bogus-wrapper"><notextile><figure class="code"> <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="n">cuts</span> <span class="o">=</span> <span class="p">[</span><span class="n">times</span> <span class="k">for</span> <span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="ow">in</span> <span class="n">times_texts</span>
</span><span class="line">              <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">&quot;applause&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="o">!=</span> <span class="p">[])]</span>
</span><span class="line"><span class="n">assemble_cuts</span><span class="p">(</span><span class="n">cuts</span><span class="p">,</span> <span class="s">&quot;applause.mp4&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="embed-video-container"><iframe src="http://www.youtube.com/embed/81uprP2GzxI "></iframe></div>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Zulko</span></span>

      








  


<time datetime="2014-06-21T18:03:00+02:00" pubdate data-updated="true">Jun 21<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/moviepy/'>MoviePy,</a>, <a class='category' href='/blog/categories/videogrep/'>Videogrep,</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://Zulko.github.io/blog/2014/06/21/some-more-videogreping-with-python/" data-via="" data-counturl="http://Zulko.github.io/blog/2014/06/21/some-more-videogreping-with-python/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/06/07/a-covers-mix-with-python/" title="Previous Post: A covers mix with Python">&laquo; A covers mix with Python</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/07/04/automatic-soccer-highlights-compilations-with-python/" title="Next Post: Automatic Soccer Highlights Compilations with Python">Automatic Soccer Highlights Compilations with Python &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/07/04/automatic-soccer-highlights-compilations-with-python/">Automatic Soccer Highlights Compilations With Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/21/some-more-videogreping-with-python/">Some More Videogreping With Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/06/07/a-covers-mix-with-python/">A Covers Mix With Python</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/04/27/viennese-mazes-what-they-are/">Viennese Mazes: What They Are, and How to Make One</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/29/soundstretching-and-pitch-shifting-in-python/">Python, Pitch Shifting, and the Pianoputer</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/Zulko">@Zulko</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'Zulko',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Zulko -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'zulkoghio';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://Zulko.github.io/blog/2014/06/21/some-more-videogreping-with-python/';
        var disqus_url = 'http://Zulko.github.io/blog/2014/06/21/some-more-videogreping-with-python/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
